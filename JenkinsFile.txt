pipeline {
    agent any

    stages {
        stage('clone code') {
            steps {
                script{
                    git credentialsId: 'df815c87-7ae7-450b-85ed-843fa31ef441', url: 'https://github.com/marou02/intergationcontinue.git'
                    echo 'clone done'
                    }
            }
        }
                
        stage('Build') {
            steps {
                bat 'mvn clean install'
            }
        }
        stage('Test') {
            steps {
                echo 'Testing..'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
        
        
        stage("publish to nexus") {
            steps {
                script {
                    echo "Starting nexus";
                    // Read POM xml file using 'readMavenPom' step , this step 'readMavenPom' is included in:        https://plugins.jenkins.io/pipeline-utility-steps
                    pom = readMavenPom file: "pom.xml";
                    // Find built artifact under target folder
                    filesByGlob = findFiles(glob: "target/*.${pom.packaging}");
                    // Print 
                    environment {
                    NEXUS_VERSION = "nexus2"
                    NEXUS_PROTOCOL = "http"
                    NEXUS_URL = "localhost:8081/nexus/"
                    NEXUS_REPOSITORY = "release"
                    NEXUS_CREDENTIAL_ID = "nexus-credentials"
                                }
                        }
                    }
                                    }

    }
         post {
        always {
            emailext body: 'Hello!', subject: 'sending email', to: 'ghannemmarwen@gmail.com'           
                }
              }
}
